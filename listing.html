<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buscar Hogar – Ficha</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root{
      --text:#111;
      --muted:#6b7280;
      --border:#e5e7eb;
      --bg:#fff;
      --contentMax:1140px;
    }

    html,body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--text);
      background:var(--bg);
    }

    .wrap{
      max-width:var(--contentMax);
      margin:0 auto;
      padding:16px 16px 80px;
    }

    a{color:inherit;text-decoration:none}
    h1,h2{margin:0}

    /* ================= HEADER ================= */

    .back{
      display:inline-block;
      font-size:14px;
      margin-bottom:12px;
    }

    .title{
      font-size:28px;
      font-weight:700;
      margin-bottom:4px;
    }

    .subtitle{
      font-size:14px;
      color:var(--muted);
      margin-bottom:16px;
    }

    .priceRow{
      display:flex;
      gap:16px;
      align-items:baseline;
      margin-bottom:16px;
    }

    .price{
      font-size:32px;
      font-weight:700;
    }

    .priceMeta{
      font-size:14px;
      color:var(--muted);
    }

    /* ================= MEDIA PLACEHOLDER ================= */

    .media{
      width:100%;
      height:420px;
      background:#f3f4f6;
      margin-bottom:24px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#9ca3af;
    }

    /* ================= FICHA TECNICA ESTILO FUNDA ================= */

    .specGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:48px;
      margin-bottom:40px;
    }

    .specBlock h2{
      font-size:16px;
      font-weight:600;
      margin-bottom:12px;
    }

    .specTable{
      border-top:1px solid var(--border);
    }

    .specRow{
      display:grid;
      grid-template-columns: 220px 1fr;
      padding:8px 0;
      border-bottom:1px solid var(--border);
      font-size:14px;
    }

    .specKey{
      color:var(--muted);
      font-size:12px;
    }

    .specVal{
      font-size:14px;
    }

    /* ================= MAPA ================= */

    #map{
      height:360px;
      border:1px solid var(--border);
      margin-bottom:12px;
    }

    .mapNote{
      font-size:13px;
      color:var(--muted);
      margin-bottom:40px;
    }

    /* ================= DESCRIPCION ================= */

    .description h2{
      font-size:16px;
      font-weight:600;
      margin-bottom:12px;
    }

    .description p{
      font-size:14px;
      line-height:1.6;
      white-space:pre-wrap;
    }

    @media(max-width:900px){
      .specGrid{
        grid-template-columns:1fr;
        gap:32px;
      }
      .specRow{
        grid-template-columns: 160px 1fr;
      }
    }
  </style>
</head>

<body>
<div class="wrap">

  <a class="back" href="./">← Volver al mapa</a>

  <h1 class="title" id="title">—</h1>
  <div class="subtitle" id="subtitle">—</div>

  <div class="priceRow">
    <div class="price" id="price">—</div>
    <div class="priceMeta">costes del comprador</div>
  </div>

  <div class="media">Media (pendiente)</div>

  <!-- ================= FICHA TECNICA ================= -->

  <div class="specGrid">

    <div class="specBlock">
      <h2>Transacción</h2>
      <div class="specTable">
        <div class="specRow"><div class="specKey">En venta desde</div><div class="specVal" id="offeredSince">—</div></div>
        <div class="specRow"><div class="specKey">Aceptación</div><div class="specVal" id="acceptance">—</div></div>
        <div class="specRow"><div class="specKey">Precio de venta</div><div class="specVal" id="askingPrice">—</div></div>
        <div class="specRow"><div class="specKey">Precio por m²</div><div class="specVal" id="priceM2">—</div></div>
        <div class="specRow"><div class="specKey">Estado</div><div class="specVal" id="status">—</div></div>
        <div class="specRow"><div class="specKey">Cuota de comunidad</div><div class="specVal" id="hoa">—</div></div>
      </div>
    </div>

    <div class="specBlock">
      <h2>Construcción</h2>
      <div class="specTable">
        <div class="specRow"><div class="specKey">Tipo de vivienda</div><div class="specVal" id="apartmentType">—</div></div>
        <div class="specRow"><div class="specKey">Tipo de construcción</div><div class="specVal" id="constructionType">—</div></div>
        <div class="specRow"><div class="specKey">Año de construcción</div><div class="specVal" id="builtYear">—</div></div>
        <div class="specRow"><div class="specKey">Tipo de cubierta</div><div class="specVal" id="roofType">—</div></div>
      </div>
    </div>

  </div>

  <!-- ================= MAPA ================= -->

  <div id="map"></div>
  <div class="mapNote">Ubicación aproximada. La dirección exacta puede variar por privacidad.</div>

  <!-- ================= DESCRIPCION ================= -->

  <div class="description">
    <h2>Descripción</h2>
    <p id="description">
Descripción pendiente de publicación por la agencia.

En cuanto esté disponible, aquí aparecerá el texto completo con la información estructurada del inmueble, tal y como exige el estándar de la plataforma.
    </p>
  </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const SUPABASE_URL = "https://dpusnylssfjnksbieimj.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_tSSgJcWWRfEe2uob7SFYgw_AqcBL7KK";

const id = new URLSearchParams(location.search).get("id");

function euro(n){
  return new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(n);
}

fetch(`${SUPABASE_URL}/rest/v1/listing_detail_public?listing_id=eq.${id}&limit=1`,{
  headers:{apikey:SUPABASE_ANON_KEY,Authorization:`Bearer ${SUPABASE_ANON_KEY}`}
})
.then(r=>r.json())
.then(([d])=>{
  if(!d) return;

  document.getElementById("title").textContent = d.address_display;
  document.getElementById("subtitle").textContent = `${d.postcode || ""} ${d.city || ""}`;
  document.getElementById("price").textContent = d.price_eur ? euro(d.price_eur) : "—";

  document.getElementById("offeredSince").textContent = d.listed_at ? new Date(d.listed_at).toLocaleDateString("es-ES") : "—";
  document.getElementById("askingPrice").textContent = d.price_eur ? euro(d.price_eur) : "—";
  document.getElementById("priceM2").textContent = (d.price_eur && d.useful_area_m2) ? euro(Math.round(d.price_eur/d.useful_area_m2)) : "—";
  document.getElementById("builtYear").textContent = d.built_year || "—";

  const map = L.map("map",{scrollWheelZoom:false}).setView([d.lat||0,d.lng||0],14);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  if(d.lat && d.lng) L.marker([d.lat,d.lng]).addTo(map);
});
</script>

</body>
</html>





